syntax = "proto3";
import "common.proto";
package idp2p.pb;

message EventLogPayload{
    bytes previous = 1; // Multihash of previous event payload
    bytes signer_key = 2; // Raw signer public key 
    Idp2pKeyDigest next_key_digest = 3; 
    int64 timestamp = 4;
    oneof event_log_change {
        Idp2pKeyDigest recover = 5;
        IdentityEvents events = 6; 
    }
    message IdentityEvents {
        repeated IdentityEvent events = 1;
    }
}

message IdentityEvent {
    oneof identity_event_type { 
        Idp2pKey set_assertion_key = 1; 
        Idp2pKey set_authentication_key = 2; 
        Idp2pKey set_agreement_key = 3;
        Idp2pProof set_proof = 4;
    }
}

message IdentityInception {
    Idp2pKeyDigest next_key_digest = 1; 
    Idp2pKeyDigest recovery_key_digest= 2; 
    repeated IdentityEvent events = 3; 
}

message EventLog {
    bytes payload = 1;  // For deterministic proof
    bytes proof = 2;
}

message Microledger {
    bytes inception = 1; // For deterministic id
    repeated EventLog event_logs = 2;
}

message Identity {
    bytes id = 1;
    Microledger microledger = 2;
}


